///
/// @package @maddimathon/utility-sass@0.1.0-alpha.draft
/// @since 0.1.0-alpha.draft
///
// @use 'sass:color';
@use 'sass:list';
@use 'sass:map';
// @use 'sass:math';
@use 'sass:meta';
@use 'sass:selector';
@use 'sass:string';

@use '../../../config';
// @use '../../../tokens';

@use '../../01-01-meta' as *;
// @use '../../01-02-lists' as *;
// @use '../../01-03-maps' as *;
// @use '../../01-04-numbers' as *;
// @use '../../01-05-strings' as *;
@use '../../01-06-selectors' as *;
// @use '../../01-07-colours' as *;
// @use '../../01-08-accessibility' as *;
// @use '../../01-09-typography' as *;

// @use '../01-11-01-spacing' as *;

@use '01-11-02-01-meta' as *;
// @use '01-11-02-02-utils' as *;
@use '01-11-02-03-args' as *;

/// # MODE TOKEN FUNCTIONS - SELECTORS
/// ======================================================================== ///

///
/// Returns the selectors for the given colour modes.
///
/// @param {bool} $modeArgs  Optional. Whether the token-mode-validate-args() function has already been applied to the args. Default false.
/// @param {bool} $args...   Remaining args. See {@link token-mode-validate-args()} for details.
///
/// @since 0.1.0-alpha.draft
///
@function media-queries-token-mode($modeArgs: false, $args...) {
    @if not $modeArgs {
        $args: token-mode-validate-args($args...);
    } @else {
        $args: meta.keywords($args);
    }

    $modes: map.get($args, 'modes');
    $includeDefault: map.get($args, 'includeDefault');
    $includeSelectors: map.get($args, 'includeSelectors');

    $nestParentSelector: map.get($args, 'nestParentSelector');
    $unifyParentSelector: map.get($args, 'unifyParentSelector');
    $wrapParentSelector: map.get($args, 'wrapParentSelector');

    $ignoreParentSelector: map.get($args, 'ignoreParentSelector');
    $parentSelector: map.get($args, 'parentSelector');
    $parentSelectorExists: map.get($args, 'parentSelectorExists');

    $debug: map.get($args, 'debug');

    @if $debug {
        @debug '';
        @debug '=  =  =';
        @debug 'media-queries-token-mode()';
        @debug '';
        @debug '$modes = #{var-dump($modes)}';
        @debug '$includeDefault = #{var-dump($includeDefault)}';
        @debug '';
        @debug '$nestParentSelector = #{var-dump($nestParentSelector)}';
        @debug '$unifyParentSelector = #{var-dump($unifyParentSelector)}';
        @debug '$wrapParentSelector = #{var-dump($wrapParentSelector)}';
        @debug '';
        @debug '$ignoreParentSelector = #{var-dump($ignoreParentSelector)}';
        @debug '$parentSelector = #{var-dump($parentSelector)}';
        @debug '$parentSelectorExists = #{var-dump($parentSelectorExists)}';
    }

    $queries: ();

    @each $mode in $modes {
        $isClrModeDefault: false;
        $isClrModeDefaultOnly: is-token-mode-type-default-only($mode);

        @if is-token-mode-default($mode) {
            $isClrModeDefault: true;
        }
        @if $debug {
            @debug '';
            @debug '$mode = #{var-dump($mode)}';
            @debug '$isClrModeDefault = #{var-dump($isClrModeDefault)}';
            @debug '$isClrModeDefaultOnly = #{var-dump($isClrModeDefaultOnly)}';
        }

        @if $isClrModeDefaultOnly {
            @if $debug {
                @debug 'skipping queries';
            }
        } @else {
            @if $mode == light or $mode == dark {
                @if not
                    $isClrModeDefault or not
                    $includeDefault or not
                    $includeSelectors
                {
                    @if $debug {
                        @debug 'adding #{$mode} query';
                    }

                    @if $isClrModeDefault and
                        config.$include_noPreferenceMediaQueries
                    {
                        $queries: list.append(
                            $queries,
                            '( prefers-color-scheme: no-preference )',
                            $separator: comma
                        );
                    }
                    $queries: list.append(
                        $queries,
                        '( prefers-color-scheme: #{$mode} )',
                        $separator: comma
                    );
                } @else if $debug {
                    @debug 'skipping #{$mode} query';
                }
            } @else if $mode == forced-colors {
                @if $debug {
                    @debug 'adding #{$mode} query';
                }
                $queries: list.append(
                    $queries,
                    '( forced-colors: active )',
                    $separator: comma
                );
                $queries: list.append(
                    $queries,
                    '( prefers-contrast: custom )',
                    $separator: comma
                );
            } @else if $mode == low {
                @if $debug {
                    @debug 'adding #{$mode} query';
                }
                $queries: list.append(
                    $queries,
                    '( prefers-contrast: less )',
                    $separator: comma
                );
            } @else if $mode == average {
                @if not
                    $isClrModeDefault or not
                    $includeDefault or not
                    $includeSelectors
                {
                    @if $debug {
                        @debug 'adding #{$mode} query';
                    }

                    @if config.$include_noPreferenceMediaQueries {
                        $queries: list.append(
                            $queries,
                            '( prefers-contrast: no-preference )',
                            $separator: comma
                        );
                    }
                } @else if $debug {
                    @debug 'skipping #{$mode} query';
                }
            } @else if $mode == high {
                @if $debug {
                    @debug 'adding #{$mode} query';
                }
                $queries: list.append(
                    $queries,
                    '( prefers-contrast: more )',
                    $separator: comma
                );
            } @else {
                @if $debug {
                    @debug "no queries for mode '#{$mode}'";
                }
            }
        }
    }

    @if $debug {
        @debug '';
        @debug '$queries = #{var-dump($queries)}';
        @debug '=  =  =';
        @debug '';
    }
    @return $queries;
}

///
/// Returns the selectors for the given colour modes.
///
/// @param {bool} $modeArgs  Optional. Whether the token-mode-validate-args() function has already been applied to the args. Default false.
/// @param {bool} $args...   Remaining args. See {@link token-mode-validate-args()} for details.
///
/// @since 0.1.0-alpha.draft
///
@function selectors-token-mode($modeArgs: false, $args...) {
    @if not $modeArgs {
        $args: token-mode-validate-args($args...);
    } @else {
        $args: meta.keywords($args);
    }

    $modes: map.get($args, 'modes');
    $includeDefault: map.get($args, 'includeDefault');

    $nestParentSelector: map.get($args, 'nestParentSelector');
    $unifyParentSelector: map.get($args, 'unifyParentSelector');
    $wrapParentSelector: map.get($args, 'wrapParentSelector');

    $parentIsRoot: map.get($args, 'parentIsRoot');

    $ignoreParentSelector: map.get($args, 'ignoreParentSelector');
    $parentSelector: map.get($args, 'parentSelector');
    $parentSelectorExists: map.get($args, 'parentSelectorExists');

    $debug: map.get($args, 'debug');

    @if $debug {
        @debug '';
        @debug '=  =  =';
        @debug 'selectors-token-mode()';
        @debug '';
        @debug 'config.$selectorType_mode = #{var-dump(config.$selectorType_mode)}';
        @debug '';
        @debug '$modes = #{var-dump($modes)}';
        @debug '$includeDefault = #{var-dump($includeDefault)}';
        @debug '';
        @debug '$nestParentSelector = #{var-dump($nestParentSelector)}';
        @debug '$unifyParentSelector = #{var-dump($unifyParentSelector)}';
        @debug '$wrapParentSelector = #{var-dump($wrapParentSelector)}';
        @debug '';
        @debug '$ignoreParentSelector = #{var-dump($ignoreParentSelector)}';
        @debug '$parentSelector = #{var-dump($parentSelector)}';
        @debug '$parentSelectorExists = #{var-dump($parentSelectorExists)}';
    }

    $prependParentSelector: false;
    $selectorsList: ();

    @each $mode in $modes {
        $isDefaultOnly: is-token-mode-type-default-only($mode);
        $isDefault: is-token-mode-default($mode);

        @if $debug {
            @debug '';
            @debug '$mode = #{var-dump($mode)}';
            @debug '$isDefaultOnly = #{var-dump($isDefaultOnly)}';
            @debug '$isDefault = #{var-dump($isDefault)}';
        }

        @if $includeDefault and $isDefault {
            $prependParentSelector: true;
        }

        @if not $isDefaultOnly or $isDefault {
            $modeType: get-token-mode-type($mode);

            $selector: ();

            @if config.$selectorType_mode == 'attribute' {
                $selector: (
                    string.unquote('[data-#{$modeType}-mode=#{$mode}]')
                );
            }

            @if config.$selectorType_mode == 'class' {
                $selector: (
                    string.unquote('.theme-#{$modeType}-mode-#{$mode}')
                );
            }

            @if $debug {
                @debug '$selector = #{var-dump($selector)}';
            }

            @if list.length($selector) > 0 {
                $mergedSelectors: ();

                @if $parentSelectorExists and not $parentIsRoot {
                    $mergedSelectors: selectors-merge(
                        $selectorA: $parentSelector,
                        $selectorB: $selector,

                        $nestAinB: $nestParentSelector,
                        $nestBinA: $wrapParentSelector,
                        $unify: $unifyParentSelector,

                        $debug: $debug,
                    );
                } @else {
                    $mergedSelectors: $selector;
                }
                @if $debug {
                    @debug '$mergedSelectors = #{var-dump($mergedSelectors)}';
                }

                $selectorsList: list.append(
                    $selectorsList,
                    $mergedSelectors,
                    $separator: comma
                );
            }
        } @else if $debug {
            @debug 'no selectors added';
        }
    }

    @if $debug {
        @debug '';
        @debug '$prependParentSelector = #{var-dump($prependParentSelector)}';
    }

    @if $prependParentSelector {
        $selectorsList: list.join(
            $parentSelector,
            $selectorsList,
            $separator: comma
        );
    }

    @if $debug {
        @debug '';
        @debug '$selectorsList = #{var-dump($selectorsList)}';
        @debug '=  =  =';
        @debug '';
    }
    @if list.length($selectorsList) < 1 {
        @return config.$selector_null;
    }
    @if $parentIsRoot and $parentSelectorExists {
        @return selector.unify(
            $parentSelector,
            (string.unquote(':has( #{$selectorsList} )'))
        );
    }
    @return $selectorsList;
}
