///
/// @package @maddimathon/utility-sass@0.1.0-alpha.14
/// @since 0.1.0-alpha
///

@use 'sass:meta';

@use '../../config';

@use 'get-selector' as *;

///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha — Moved from library to own module.
///
@mixin js($args...) {
    $args: meta.keywords($args);

    @at-root #{get-selector(
        $key: null,
        $bool: true,
        $args...,
    )} {
        @content;
    }
}

///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha — Moved from library to own module.
///
@mixin no-js($args...) {
    $args: meta.keywords($args);

    @at-root #{get-selector(
        $key: null,
        $bool: false,
        $args...,
    )} {
        @content;
    }
}

///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha — Moved from library to own module.
/// @since 0.1.0-alpha.5 — Changed name from `js-support` to `supports`.
///
@mixin supports($key, $args...) {
    $args: meta.keywords($args);

    @if $key == whereSelector {
        @include js($args...) {
            @content;
        }
    } @else {
        @at-root #{get-selector( $key, true, $args... )} {
            @content;
        }
    }
}

///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha — Moved from library to own module.
/// @since 0.1.0-alpha.5 — Changed name from `js-no-support` to `supports-not`.
///
@mixin supports-not($key, $addSelectors: (), $addSelectors_noJS: (), $args...) {
    $args: meta.keywords($args);

    @include no-js(
        $addSelectors: if(
                $key == whereSelector,
                $addSelectors,
                $addSelectors_noJS
            ),
        $args...
    ) {
        @content;
    }

    @if $key != whereSelector {
        @at-root #{get-selector( $key, false, $addSelectors: $addSelectors, $args... )} {
            @content;
        }
    }
}

///
/// Declares an aspect-ratio property and then inserts a fallback if aspect
/// ratio is unsupported.
///
/// @since 0.1.0-alpha.5
///
@mixin aspect-ratio($w, $h) {
    aspect-ratio: #{$w} / #{$h};

    @include supports-not(aspectRatio) {
        /* aspect-ratio fallback */
        position: relative;

        &::before {
            /* aspect-ratio fallback */
            content: '';
            float: left;
            padding-top: #{calc(($h / $w) * 100%)};
        }

        &::after {
            /* aspect-ratio fallback */
            content: '';
            display: block;
            clear: both;
        }
    }
}
