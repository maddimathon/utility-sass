///
/// @package @maddimathon/utility-sass@0.1.0-pre.3
/// @since 0.1.0-pre.0
///

@use 'sass:list';
@use 'sass:math';
@use 'sass:meta';

@use '../math/num-val';
@use '../string';

// #region $lettersLowerCase
$lettersLowerCase: (
    a,
    b,
    c,
    d,
    e,
    f,
    g,
    h,
    i,
    j,
    k,
    l,
    m,
    n,
    o,
    p,
    q,
    r,
    s,
    t,
    u,
    v,
    w,
    x,
    y,
    z
);
// #endregion $lettersLowerCase

// #region $sortOrder
$sortOrder: list.join(
    (
        ' ',
        '-',
        _,
        0,
        '0',
        1,
        '1',
        2,
        '2',
        3,
        '3',
        4,
        '4',
        5,
        '5',
        6,
        '6',
        7,
        '7',
        8,
        '8',
        9,
        '9'
    ),
    $lettersLowerCase
);
// #endregion $sortOrder

///
/// @return {number} true if $string_a goes before $string_b and false if not
///
@function _compare($string_a, $string_b) {
    $string_a: string.slugify('#{$string_a}');
    $string_b: string.slugify('#{$string_b}');

    @for $i
        from 1
        through math.min(string.length($string_a), string.length($string_b))
    {
        $char_a: string.slice($string_a, $i, $i);
        $char_b: string.slice($string_b, $i, $i);

        @if $char_a and
            $char_b and
            list.index($sortOrder, $char_a) !=
            list.index($sortOrder, $char_b)
        {
            @return (
                list.index($sortOrder, $char_a) <
                    list.index($sortOrder, $char_b)
            );
        }
    }

    @return string.length($string_a) < string.length($string_b);
}

///
/// Swaps the position of two items in a list.
///
@function _swap($list, $index_a, $index_b) {
    // returns - invalid list indices
    @if math.abs($index_a) >
        list.length($list) or
        math.abs($index_b) >
        list.length($list)
    {
        @return $list;
    }

    $tmp_value_a: list.nth($list, $index_a);

    $list: list.set-nth($list, $index_a, list.nth($list, $index_b));

    $list: list.set-nth($list, $index_b, $tmp_value_a);

    @return $list;
}

///
/// Sorts a list of items as strings.
///
/// @since 0.1.0-pre.0
///
@function sort($list, $sortAs: 'string') {
    // iterate through items
    @for $i from 1 through list.length($list) {
        // swaps with nearby items as relevant
        @for $index_a from $i * -1 through -1 {
            $index_a: math.abs($index_a);
            $index_b: $index_a - 1;

            @if $index_a > 1 {
                $str_a: list.nth($list, $index_a);
                $str_b: list.nth($list, $index_b);

                $swap: false;

                @if $sortAs == 'number' {
                    $_a_isNum: meta.type-of($str_a) == number;
                    $_b_isNum: meta.type-of($str_b) == number;

                    @if not
                        $_a_isNum and
                        list.index($lettersLowerCase, $str_a) ==
                        null
                    {
                        $str_a: num-val.num-val($str_a);
                        $_a_isNum: true;
                    }

                    @if not
                        $_b_isNum and
                        list.index($lettersLowerCase, $str_b) ==
                        null
                    {
                        $str_b: num-val.num-val($str_b);
                        $_b_isNum: true;
                    }

                    @if $_a_isNum and $_b_isNum {
                        $swap: if($str_a < $str_b, true, false);
                    }
                } @else {
                    $swap: _compare($str_a, $str_b);
                }

                @if $swap {
                    $list: _swap($list, $index_a, $index_b);
                }
            }
        }
    }

    @return $list;
}
