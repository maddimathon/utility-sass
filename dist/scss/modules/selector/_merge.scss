///
/// @package @maddimathon/utility-sass@0.1.0-alpha.13
/// @since 0.1.0-pre.0
///

@use 'sass:list';
@use 'sass:selector';
@use 'sass:string';

@use '../meta';

@use '../../config';

///
/// Joins given selectors together nested in both directions and unified.
///
/// @param {selector} $selectorA  Selector to combine.
/// @param {selector} $selectorB  Selector to combine.
///
/// @param {bool} $nestAinB  Whether to nest $selectorB in $selectorA.
/// @param {bool} $nestBinA  Whether to nest $selectorA in $selectorB.
/// @param {bool} $unify     Whether to unify the selectors.
///
/// @param {bool} $debug  Whether to print compiler information to the console.
///
/// @return {selector}
///
/// @since 0.1.0-pre.0
///
@function merge(
    $selectorA,
    $selectorB,
    $nestAinB: true,
    $nestBinA: true,
    $unify: true,

    $debug: false
) {
    @if $debug {
        @debug '';
        @debug '--  --  --';
        @debug 'selector.merge()';
        @debug '';
        @debug '$selectorA = #{meta.var-dump($selectorA)}';
        @debug '$selectorB = #{meta.var-dump($selectorB)}';
        @debug '';
        @debug '$nestAinB = #{meta.var-dump($nestAinB)}';
        @debug '$nestBinA = #{meta.var-dump($nestBinA)}';
        @debug '$unify = #{meta.var-dump($unify)}';
    }

    $selectorA: (string.unquote('#{$selectorA}'));
    $selectorB: (string.unquote('#{$selectorB}'));

    @if $debug {
        @debug '';
        @debug '$selectorA = #{meta.var-dump($selectorA)}';
        @debug '$selectorB = #{meta.var-dump($selectorB)}';
    }

    $ret_override: null;

    @if string.length('#{$selectorA}') < 1 {
        $selectorA: config.$selector_null;
    }
    @if string.length('#{$selectorB}') < 1 {
        $selectorB: config.$selector_null;
    }

    @if $selectorA ==
        config.$selector_null and
        $selectorB ==
        config.$selector_null
    {
        $ret_override: config.$selector_null;
    } @else {
        @if $selectorA == config.$selector_null {
            $ret_override: $selectorB;
        }
        @if $selectorB == config.$selector_null {
            $ret_override: $selectorA;
        }
    }

    @if $ret_override != null {
        @if $debug {
            @debug '';
            @debug 'bailing early';
            @debug '$selectors = #{$ret_override}';
            @debug '-  -  -';
            @debug '';
        }
        @return $ret_override;
    }

    $selectors: ();

    @if $nestAinB {
        $selectors: list.append(
            $selectors,
            selector.nest($selectorB, $selectorA),
            $separator: comma
        );
    }

    @if $nestBinA {
        $selectors: list.append(
            $selectors,
            selector.nest($selectorA, $selectorB),
            $separator: comma
        );
    }

    @if $unify {
        $selectors: list.append(
            $selectors,
            selector.unify($selectorA, $selectorB),
            $separator: comma
        );
    }

    @if $debug {
        @debug '';
        @debug '$selectors = #{$selectors}';
        @debug '--  --  --';
        @debug '';
    }

    @if list.length($selectors) > 0 {
        @if $debug {
            @debug '';
            @debug '$selectors = ';
            @each $select in $selectors {
                @debug #{meta.var-dump($select)};
            }
        }
        @return $selectors;
    }
    @return config.$selector_null;
}
