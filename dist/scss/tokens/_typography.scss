///
/// @package @maddimathon/utility-sass@0.1.0-pre.0
/// @since 0.1.0-pre.0
///

@use '../config';

@use '../modules/list';
@use '../modules/map';
@use '../modules/math';
@use '../modules/meta';

@use 'spacing';

/// # TOKENS - TYPOGRAPHY
/// ======================================================================== ///

/// ## Font Sizes ==================================== ///

///
/// A map (merged with the defaults) of font size multipliers (0 = base size)
/// used with the font size mixins and --fs-X properties.
///
/// @since 0.1.0-pre.0
///
$font_sizes: () !default;

$font_sizes: map.merge(
    (
        'heading': (
            '1': 7,
            '2': 5,
            '3': 4,
            '4': 3,
            '5': 2,
            '6': 1,
            '7': -0.625,
            '8': -1.5,
        ),

        'smaller': (
            // '5': -3.0,
            // '4': -2.5,
            // '3': -2.0,
            '2': -1.25,
            '1': -0.5,
        ),

        'normal': 0,

        'bigger': (
            '7': 7,
            '8': 8,
            '9': 9,
        ),
    ),
    $font_sizes,
    $recursive: true
);

@function _ksort_sizes($map, $_isFirstLevel: true) {
    // sorts the keys
    $ordered_keys: if(
        $_isFirstLevel,
        map.keys($map),
        list.sort(
            list.sort(map.keys($map), $sortAs: 'string'),
            $sortAs: 'number'
        )
    );

    $ordered_map: ();

    @each $key in $ordered_keys {
        $value: map.get($map, $key);

        @if meta.type-of($value) == map {
            $value: _ksort_sizes($value, $_isFirstLevel: false);
        }

        $ordered_map: map.set($ordered_map, $key, $value);
    }

    @return $ordered_map;
}

// sort recursively
$font_sizes: _ksort_sizes($font_sizes);

// reverse the smaller sizes
$font_sizes: map.set(
    $font_sizes,
    smaller,
    map.ksort(map.get($font_sizes, smaller), $sortAs: 'number', $reverse: true)
);

// flatten the map
$font_sizes: map.flatten($font_sizes);

// now rounding
@each $key, $value in $font_sizes {
    $font_sizes: map.set(
        $font_sizes,
        $key,
        math.round-to-pixel(
            math.pow(spacing.$scale_multiplier, $value),
            $factor: config.$fn_fontRoundToPixelFactor
        )
    );
}

/// ## Line Heights ==================================== ///

///
/// Base line height used to build other levels.
///
/// @since 0.1.0-pre.0
///
$line_height_base: 1.6875 !default;

///
/// A map (merged with the defaults) of line height multipliers (0 = base lh)
/// used with the line heights mixins and --line-height-X properties.
///
/// @since 0.1.0-pre.0
///
$line_heights: () !default;

$line_heights: map.merge(
    (
        '100': -2.75,
        '200': -2,
        '300': -1.25,
        '400': 0,
        '500': 1,
        '600': 2,
    ),
    $line_heights
);

@each $key, $value in $line_heights {
    $lh: (
        math.pow(spacing.$scale_multiplier, $value * 0.875) * $line_height_base
    );

    $line_heights: map.set($line_heights, $key, math.round-to-pixel($lh, 32));
}
