///
/// @package @maddimathon/utility-sass@0.1.0-alpha.36
/// @since 0.1.0-pre.0
///

@use '../../../config';

@use '../../../modules/feature-check';
@use '../../../modules/list';
@use '../../../modules/meta';
@use '../../../modules/selector';
@use '../../../modules/string';

@use '../../01-functions' as *;

// @use '02-01-01-accessibility' as *;
// @use '02-01-02-breakpoints' as *;

/// # UTILITY MIXINS - Fallbacks
/// ======================================================================== ///

/// ## Focus & Hover ==================================== ///

///
/// To be nested IN the target element to add a fallback for `focus-visible` (and
/// `focus-visible`, plus any additional selectors).
///
/// @since 0.1.0-pre.0
///
@mixin focus-visible(
    $addSelectors: (),
    $includeFallbacks: config.$mx_interactive_states_include_fallbacks,
    $fallbacksOnly: config.$mx_interactive_states_include_fallbacks_only,
    $includeParentSelector: true,
    $args...
) {
    $args: meta.keywords($args);

    // force fallbacks only when applicable
    @if not config.$include_featureCheck {
        $fallbacksOnly: true;
    }

    $sel_focus: (string.unquote(':focus'));
    $sel_focusVisible: (string.unquote(':focus-visible'));

    @if $includeParentSelector and selector.parent-exists() {
        $sel_focus: selector.unify(&, $sel_focus);
        $sel_focusVisible: selector.unify(&, $sel_focusVisible);
    }

    $sel_additional: if(
        list.length($addSelectors) > 0,
        $addSelectors,
        config.$selector_null
    );

    @at-root {
        @if $fallbacksOnly {
            #{$sel_focus} {
                @content;
            }
        } @else if $includeFallbacks {
            #{$sel_focus} {
                @include feature-check.supports-not(
                    'focusVisible',
                    $addSelectors: (),
                    $args...
                ) {
                    @content;
                }
            }
        }

        #{$sel_additional} {
            @content;
        }

        @if not $fallbacksOnly {
            #{$sel_focusVisible} {
                @content;
            }
        }
    }
}

///
/// For setting `focus-visible` and `focus-within`, with fallback for
/// `focus-visible` and `focus-within` is set separately for slightly better
/// compatibility.
///
/// @since 0.1.0-pre.0
///
@mixin focus-visible-or-within(
    $addSelectors: (),
    $includeFallbacks: config.$mx_interactive_states_include_fallbacks,
    $fallbacksOnly: config.$mx_interactive_states_include_fallbacks_only,
    $includeParentSelector: true,
    $args...
) {
    $args: meta.keywords($args);

    // force fallbacks only when applicable
    @if not config.$include_featureCheck {
        $fallbacksOnly: true;
    }

    @include focus-visible(
        $addSelectors: $addSelectors,
        $includeFallbacks: $includeFallbacks,
        $fallbacksOnly: $fallbacksOnly,
        $includeParentSelector: $includeParentSelector,
        $args...
    ) {
        @content;
    }

    $sel_focusWithin: (string.unquote(':focus-within'));

    @if $includeParentSelector and selector.parent-exists() {
        $sel_focusWithin: selector.unify(&, $sel_focusWithin);
    }

    @at-root {
        #{$sel_focusWithin} {
            @content;
        }
    }
}

///
/// Adds `hover` to `focus-visible` mixin.
///
/// @since 0.1.0-pre.0
///
@mixin hover-focus-visible(
    $addSelectors: (),
    $includeFallbacks: config.$mx_interactive_states_include_fallbacks,
    $fallbacksOnly: config.$mx_interactive_states_include_fallbacks_only,
    $includeParentSelector: true,
    $args...
) {
    $args: meta.keywords($args);

    // force fallbacks only when applicable
    @if not config.$include_featureCheck {
        $fallbacksOnly: true;
    }

    $sel_hover: (string.unquote(':hover'));

    @if $includeParentSelector and selector.parent-exists() {
        $sel_hover: selector.unify(&, $sel_hover);
    }

    @include focus-visible(
        list.join($sel_hover, $addSelectors, $separator: comma),
        $includeFallbacks: $includeFallbacks,
        $fallbacksOnly: $fallbacksOnly,
        $args...
    ) {
        @content;
    }
}

///
/// Adds `hover` to `focus-visible-or-within` mixin.
///
/// @since 0.1.0-pre.0
///
@mixin hover-focus-visible-or-within(
    $addSelectors: (),
    $includeFallbacks: config.$mx_interactive_states_include_fallbacks,
    $fallbacksOnly: config.$mx_interactive_states_include_fallbacks_only,
    $includeParentSelector: true,
    $args...
) {
    $args: meta.keywords($args);

    // force fallbacks only when applicable
    @if not config.$include_featureCheck {
        $fallbacksOnly: true;
    }

    $sel_hover: (string.unquote(':hover'));

    @if $includeParentSelector and selector.parent-exists() {
        $sel_hover: selector.unify(&, $sel_hover);
    }

    @include focus-visible-or-within(
        list.join(($sel_hover), $addSelectors, $separator: comma),
        $includeFallbacks: $includeFallbacks,
        $fallbacksOnly: $fallbacksOnly,
        $args...
    ) {
        @content;
    }
}

@mixin _hover($includeParentSelector: true, $args...) {
    $args: meta.keywords($args);

    $selector: if(
        $includeParentSelector and selector.parent-exists(),
        (string.unquote('&:hover')),
        (string.unquote(':hover'))
    );

    @at-root #{$selector} {
        @content;
    }
}
@mixin _focus-within($includeParentSelector: true, $args...) {
    $args: meta.keywords($args);

    $selector: if(
        $includeParentSelector and selector.parent-exists(),
        (string.unquote('&:focus-within')),
        (string.unquote(':focus-within'))
    );

    @at-root #{$selector} {
        @content;
    }
}
@mixin _hover-focus-within($args...) {
    $args: meta.keywords($args);

    @include _focus-within($args...) {
        @content;
    }

    @include _hover($args...) {
        @content;
    }
}
@mixin _nothing($args...) {
    $args: meta.keywords($args);

    #{config.$selector_null} {
        @content;
    }
}

///
/// Fetches the appropriate mixin depending on input values.
///
/// @since 0.1.0-pre.0
///
@mixin apply-interactive-mixin(
    $hover: false,
    $focus: false,
    $focusWithin: false,
    $args...
) {
    $args: meta.keywords($args);
    $mixin: meta.get-mixin('_nothing');

    @if $hover and $focus and $focusWithin {
        $mixin: meta.get-mixin('hover-focus-visible-or-within');
    } @else if $hover and $focus and not $focusWithin {
        $mixin: meta.get-mixin('hover-focus-visible');
    } @else if $hover and not $focus and $focusWithin {
        $mixin: meta.get-mixin('_hover-focus-within');
    } @else if $hover and not $focus and not $focusWithin {
        $mixin: meta.get-mixin('_hover');
    } @else if not $hover and $focus and $focusWithin {
        $mixin: meta.get-mixin('focus-visible-or-within');
    } @else if not $hover and $focus and not $focusWithin {
        $mixin: meta.get-mixin('focus-visible');
    } @else if not $hover and not $focus and $focusWithin {
        $mixin: meta.get-mixin('_focus-within');
    }

    @if meta.accepts-content($mixin) {
        @include meta.apply($mixin, $args...) {
            @content;
        }
    }
}
