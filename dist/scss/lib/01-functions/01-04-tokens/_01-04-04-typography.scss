///
/// @package @maddimathon/utility-sass@0.1.0-alpha.16
/// @since 0.1.0-pre.0
///

@use '../../../modules/list';
@use '../../../modules/map';
@use '../../../modules/math';
@use '../../../modules/string';

@use '../../../config';
@use '../../../tokens';

@use '../01-03-typography' as *;

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {number}
///
/// @since 0.1.0-pre.0
///
@function fs-value(
    $slug,
    $fontScale: config.$fn_fontSizeValue_defaultFontScale,
    $clampFontSize: null
) {
    // returns
    @if not map.has-key(tokens.$font_sizes, $slug) {
        @warn "$slug '#{$slug}' did not match any of the font size tokens";
        @return ();
    }

    $size: map.get(tokens.$font_sizes, $slug);

    @if $clampFontSize == null {
        $clampFontSize: false;

        // returns - clamped value
        @if $slug == 'title' {
            $clampFontSize: true;
        }
        @if string.index($slug, 'heading-') == 1 {
            $clampFontSize: true;
        }
        @if string.index($slug, 'bigger-') == 1 {
            $clampFontSize: true;
        }
    }

    @if $clampFontSize {
        @return (
            calc(
                1rem *
                    math.round-to-pixel(
                        $size * $fontScale,
                        $factor: config.$fn_fontSizeValue_roundToPixelFactor
                    )
            ),
            clamp-font-size($size * $fontScale, $unit: 1rem)
        );
    }

    @return calc(1rem * math.round-to-pixel($size * $fontScale));
}

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {number}
///
/// @since 0.1.0-pre.0
///
@function line-height-value($level) {
    $value: map.get(tokens.$line_heights, '400');

    @if not map.has-key(tokens.$line_heights, '#{$level}') {
        @warn "$level was not a key in tokens.$line_heights";
    } @else {
        $value: map.get(tokens.$line_heights, '#{$level}');
    }

    @return $value;
}

///
/// Uses the line height config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-line-height($slug) {
    $fallback: line-height-value($slug);

    @return if(
        config.$fn_var_replaceWithValue_lineHeight,
        $fallback,
        var(--#{config.$cxPropPre}line-height-#{$slug}, $fallback)
    );
}

/// ## VARIABLES ==================================== ///

///
/// Uses the font size config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-fs($slug, $fallback: null) {
    //
    // if theres's no fallback set, then we use the fs-value function to find one
    // returns if no fallback
    @if $fallback == null {
        $fallback: fs-value($slug);

        // returns
        @if list.length($fallback) < 1 {
            @return var(--#{config.$cxPropPre}fs-#{$slug});
        }

        $fallback: list.nth($fallback, 1);
    }

    @return if(
        config.$fn_var_replaceWithValue_fontSize,
        $fallback,
        var(--#{config.$cxPropPre}fs-#{$slug}, $fallback)
    );
}
