///
/// @package @maddimathon/utility-sass@0.1.0-alpha.22
/// @since 0.1.0-pre.0
///

@use '../../../../modules/list';
@use '../../../../modules/map';
@use '../../../../modules/meta';
@use '../../../../modules/selector';
@use '../../../../modules/string';

@use '../../../../config';
// @use '../../../../tokens';

@use '01-04-02-01-meta' as *;
@use '01-04-02-02-utils' as *;

///
/// Validates and defines defaults for arguments used in multiple clr mode
/// functions/mixins.
///
/// @since 0.1.0-pre.0
///
@function colour-mode-validate-args(
    $modes: (),
    $includeDefault: true,
    $ignoreParentSelector: false,

    $nestParentSelector: null,
    $unifyParentSelector: null,
    $wrapParentSelector: null,

    $parentIsRoot: null,
    $parentIsBody: null,

    $parentSelector: null,
    $parentSelectorExists: null,

    $debug: false,

    $optionalArgs...
) {
    @if $debug {
        @warn 'debugging colour-mode-validate-args()';
        // @debug "";
        @debug '-  -  -';
        @debug 'colour-mode-validate-args()';
        @debug '';
        @debug '& = #{meta.var-dump( & )}';
        @debug '';
        @debug '$modes = #{meta.var-dump($modes)}';
        @debug '$includeDefault = #{meta.var-dump($includeDefault)}';
        @debug '$ignoreParentSelector = #{meta.var-dump($ignoreParentSelector)}';
        @debug '';
        @debug '$nestParentSelector = #{meta.var-dump($nestParentSelector)}';
        @debug '$unifyParentSelector = #{meta.var-dump($unifyParentSelector)}';
        @debug '$wrapParentSelector = #{meta.var-dump($wrapParentSelector)}';
        @debug '';
        @debug '$parentIsRoot = #{meta.var-dump($parentIsRoot)}';
        @debug '$parentIsBody = #{meta.var-dump($parentIsBody)}';
        @debug '';
        @debug '$parentSelector = #{meta.var-dump($parentSelector)}';
        @debug '$parentSelectorExists = #{meta.var-dump($parentSelectorExists)}';
        @debug '';
        @debug '$optionalArgs = #{meta.var-dump($optionalArgs)}';
    }

    $modes: filter-colour-modes-active-only(
        $modes: $modes,
        $debug: $debug,
    );

    $parentIsRoot: if($parentIsRoot != null, $parentIsRoot, false);
    $parentIsBody: if($parentIsBody != null, $parentIsBody, false);

    @if $parentSelectorExists == null {
        $parentSelectorExists: selector.parent-exists();
    }

    @if $ignoreParentSelector {
        $parentSelectorExists: false;
    }

    @if $parentSelector == null {
        @if $parentSelectorExists {
            $parentSelector: selector.parent-or-root();
        } @else {
            $parentSelector: config.$selector_root;
            $parentIsRoot: true;
            $parentIsBody: false;
        }
    }

    // testing if parent is root or body
    @if $parentSelectorExists and not ($parentIsRoot and $parentIsBody) {
        @if $debug {
            @debug '[determining if parent is root/body]';
        }

        $simpleSels: ();

        @each $sel in selector.parse(#{$parentSelector}) {
            //
            @each $_s in string.split('#{$sel}', ' ') {
                //
                $_isACombinator: if(
                    (
                        string.index(#{$_s}, '>') or
                            string.index(#{$_s}, '+') or
                            string.index(#{$_s}, '~') or
                            (string.length(#{$_s}) < 1)
                    ),
                    true,
                    false
                );

                $simpleSels: list.join(
                    $simpleSels,
                    if(
                        $_isACombinator,
                        (#{$_s}),
                        selector.simple-selectors($_s)
                    ),
                    comma
                );
            }
        }
        @if $debug {
            @debug '$simpleSels = #{meta.var-dump($simpleSels)}';
        }

        @each $sel in $simpleSels {
            @if $debug {
                @debug '  ~  ';
                @debug '$sel = #{meta.var-dump($sel)}';
            }

            @if $parentIsRoot {
                @if $debug {
                    @debug '$parentIsRoot is truthy';
                }
            } @else if string.index($sel, ':root') == 1 {
                @if $debug {
                    @debug matched ':root';
                }
                $parentIsRoot: true;
            } @else if string.index($sel, 'html') == 1 {
                @if $debug {
                    @debug "matched 'html'";
                }
                $parentIsRoot: true;
            }

            @if $parentIsBody {
                @if $debug {
                    @debug '$parentIsBody is truthy';
                }
            } @else if string.index($sel, 'body') == 1 {
                @if $debug {
                    @debug "matched 'body'";
                }
                $parentIsBody: true;
            } @else if string.index($sel, '[data-brightness-mode=') == 1 {
                @if $debug {
                    @debug "matched '[data-brightness-mode='";
                }
                $parentIsBody: true;
            } @else if string.index($sel, '[data-contrast-mode=') == 1 {
                @if $debug {
                    @debug "matched '[data-contrast-mode='";
                }
                $parentIsBody: true;
            } @else if string.index($sel, '[data-motion=') == 1 {
                @if $debug {
                    @debug "matched '[data-motion='";
                }
                $parentIsBody: true;
            }
        }
        @if $debug {
            @debug '[/determining if parent is root/body]';
        }
    }

    @if $debug {
        @debug '';
        @debug '$parentIsRoot = #{meta.var-dump($parentIsRoot)}';
        @debug '$parentIsBody = #{meta.var-dump($parentIsBody)}';
        @debug '';
        @debug '$parentSelector = #{meta.var-dump($parentSelector)}';
        @debug '$parentSelectorExists = #{meta.var-dump($parentSelectorExists)}';
    }

    @if $nestParentSelector == null {
        $nestParentSelector: true;
        @if $parentIsRoot {
            $nestParentSelector: false;
        }
    }

    @if $unifyParentSelector == null {
        $unifyParentSelector: false;
        @if $parentIsRoot {
            $unifyParentSelector: true;
        }
    }

    @if $wrapParentSelector == null {
        $wrapParentSelector: false;
    }

    @if $debug {
        @debug '';
        @debug '$nestParentSelector = #{meta.var-dump($nestParentSelector)}';
        @debug '$unifyParentSelector = #{meta.var-dump($unifyParentSelector)}';
        @debug '$wrapParentSelector = #{meta.var-dump($wrapParentSelector)}';
    }

    $isClrModeDefault: false;

    @each $mode in $modes {
        @if is-colour-mode-default($mode) {
            $isClrModeDefault: true;
        }
    }

    $args: map.merge(
        (
            modes: $modes,
            includeDefault: $includeDefault,

            nestParentSelector: $nestParentSelector,
            unifyParentSelector: $unifyParentSelector,
            wrapParentSelector: $wrapParentSelector,

            parentSelector: $parentSelector,
            parentSelectorExists: $parentSelectorExists,

            parentIsRoot: $parentIsRoot,
            parentIsBody: $parentIsBody,

            isClrModeDefault: $isClrModeDefault,

            debug: $debug,

            clrModeArgs: true,
        ),
        meta.keywords($optionalArgs)
    );

    @if $debug {
        // @debug "";
        // @debug "$args = #{meta.var-dump($args)}";
        @debug '-  -  -';
        @debug '';
    }

    @return $args;
}
