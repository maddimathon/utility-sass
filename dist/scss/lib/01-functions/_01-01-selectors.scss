///
/// @package @maddimathon/utility-sass@0.1.0-alpha.33
/// @since 0.1.0-pre.0
///

@use '../../modules/list';
@use '../../modules/map';
@use '../../modules/math';
@use '../../modules/meta';
@use '../../modules/selector';
@use '../../modules/string';

@use '../../config';
@use '../../tokens';

$_allHeadingLevels: ();
@each $key in map.keys(tokens.$font_sizes) {
    //
    @if string.index($key, 'heading-') == 1 {
        //
        $_allHeadingLevels: list.append(
            $_allHeadingLevels,
            math.num-val(string.slice($key, 9)),
            $separator: comma
        );
    }
}
$_allHeadingLevels: list.sort($_allHeadingLevels, $sortAs: 'number');

///
/// Gets the numerical levels for all headings (by heading size tokens).
///
/// @return {list<number>}
///
/// @since 0.1.0-pre.0
///
@function token-all-heading-levels() {
    @return $_allHeadingLevels;
}

///
/// Gets the pseudo selectors for all headings (by heading size tokens).
///
/// @return {list<selector>}
///
/// @since 0.1.0-pre.0
///
@function selector-all-headings($globalsOnly: false) {
    //
    $list: if($globalsOnly, ('.page-title'), ('%unstyled-heading'));

    @each $num in token-all-heading-levels() {
        //
        @if $globalsOnly {
            $num: math.num-val($num);
            $list: list.append(
                $list,
                if($num > 0 and $num < 7, 'h#{$num}', '%h#{$num}'),
                $separator: comma
            );
        } @else {
            $list: list.append($list, '%h#{$num}', $separator: comma);
        }
    }

    @return $list;
}

///
/// Returns the motion setting selector.
///
/// @param {bool} $bool         Whether the selectors for select to include motion (true; `prefers-reduced-motion: no-preference`) or not (falsee; `prefers-reduced-motion: less`).
/// @param {bool} $nestParent   Optional. Whether to nest the parent selector inside the motion selector. Default set based on parent selector type.
/// @param {bool} $unifyParent  Optional. Whether to unify the parent selector with the motion selector. Default set based on parent selector type.
///
/// @since 0.1.0-pre.0
///
@function selector-motion(
    $bool,
    $nestParent: null,
    $unifyParent: null,
    $args...
) {
    $args: meta.keywords($args);
    $mode: if($bool, 'no-preference', 'reduce');

    @if not selector.parent-exists() {
        $nestParent: false;
        $unifyParent: false;
    } @else {
        //
        $nestParent: if(
            $nestParent == null,
            if(selector-parent-is-root(), false, true),
            $nestParent
        );

        $unifyParent: if(
            $unifyParent == null,
            if(selector-parent-is-root(), true, false),
            $unifyParent
        );
    }

    $selector: null;

    @if config.$selectorType_motion == 'attribute' {
        $selector: (string.unquote('[data-motion=#{$mode}]'));
    }

    @if config.$selectorType_motion == 'class' {
        $selector: (string.unquote('.motion-preference-#{$mode}'));
    }

    @if $selector == null {
        @return config.$selector_null;
    }

    $selectorsList: ($selector);

    @if $nestParent or $unifyParent {
        $selectorsList: selector.merge(
            $selectorsList,
            &,
            $nestAinB: false,
            $nestBinA: $nestParent,
            $unify: $unifyParent
        );
    }

    @if list.length($selectorsList) > 0 {
        @return $selectorsList;
    }

    @return config.$selector_null;
}

///
/// Checks if the parent selector (if any) is a *simple* body element selector.
///
/// This DOES NOT work for compound selectors.
///
/// @return {bool}
///
/// @since 0.1.0-pre.0
///
@function selector-parent-is-body() {
    // returns
    @if not parent-exists() {
        @return false;
    }

    $parentSelector: #{&};

    // returns
    @if $parentSelector == body {
        @return true;
    }

    // returns
    @if $parentSelector == #{config.$selector_body} {
        @return true;
    }

    @return false;
}

///
/// Checks if the parent selector (if any) is a *simple* root element selector.
///
/// This DOES NOT work for compound selectors.
///
/// @return {bool}
///
/// @since 0.1.0-pre.0
///
@function selector-parent-is-root() {
    // returns
    @if not selector.parent-exists() {
        @return false;
    }

    $parentSelector: #{&};

    // returns
    @if $parentSelector == html {
        @return true;
    }

    // returns
    @if $parentSelector == ':root' {
        @return true;
    }

    // returns
    @if $parentSelector == #{config.$selector_root} {
        @return true;
    }

    @return false;
}
