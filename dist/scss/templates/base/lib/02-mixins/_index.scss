///
/// @package @maddimathon/utility-sass@0.1.0-alpha.draft
/// @since 0.1.0-alpha.draft
///

@forward '../../../../lib/02-mixins' hide tokens-all;

@forward '02-01-tokens';

/// # EXTENDING SELECTORS
/// ======================================================================== ///

// @use '../../../../modules/colour';
@use '../../../../modules/list';
// @use '../../../../modules/map';
// @use '../../../../modules/math';
@use '../../../../modules/meta';
// @use '../../../../modules/selector';
@use '../../../../modules/string';

@use '../../../../lib/02-mixins' as lib;

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;

@mixin _extend-selectors($selectors, $selector_prefix: '', $optional: false) {
    @each $pair in $selectors {
        $pairType: meta.type-of($pair);

        @if $pairType == string {
            #{$selector_prefix}#{$pair} {
                //
                @if $optional {
                    @extend %#{$pair} !optional;
                } @else {
                    @extend %#{$pair};
                }
            }
        } @else if $pairType == list {
            @if list.length($pair) >= 2 {
                #{$selector_prefix}#{list.nth($pair, 1)} {
                    //
                    @if $optional {
                        @extend %#{list.nth($pair, 2)} !optional;
                    } @else {
                        @extend %#{list.nth($pair, 2)};
                    }
                }
            } @else {
                #{$selector_prefix}#{$pair} {
                    //
                    @if $optional {
                        @extend %#{$pair} !optional;
                    } @else {
                        @extend %#{$pair};
                    }
                }
            }
        }
    }
}

@mixin extend-selector-globals(
    $additional: (),
    $optional: null,
    $allHeadingLevels: token-all-heading-levels()
) {
    $_global_selectors: (
        // ( globals, pseudo? ),
        //
        /// ## Objects ==================================== ///
        (config.$selector_root, root),
        (config.$selector_body, body),
        hr,
        //
        /// ## Typography ==================================== ///
        ((strong, b), strong),
        ((em, i), em),
        a,
        abbr,
        p,
        blockquote,
        pre,
        code,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        //
        /// ## Lists ==================================== ///
        ol,
        ul,
        li,
        //
        /// ## Forms ==================================== ///
        label,
        fieldset,
        legend,
        input,
        select,
        textarea,
        (string.unquote('::file-selector-button'), file-selector-button),
        (
            (
                button,
                "[role='button']",
                "input[type='button']",
                "input[type='submit']"
            ),
            button
        ),
        (("input[type='reset']", '::file-selector-button'), button-secondary),
        ('::selection', selection),
        //
        /// ## Tables ==================================== ///
        table,
        tr,
        th,
        td
    );

    /// Headings - where
    @if config.$mx_extendHeadingsByRole {
        $_maximumHeading: list.nth(
            $allHeadingLevels,
            list.length($allHeadingLevels)
        );

        // for all levels
        @each $headingLevel in $allHeadingLevels {
            //
            @at-root :where([role='heading'][aria-level='#{$headingLevel}']) {
                @extend %h#{$headingLevel}--where;
            }
        }
    }

    // universal focus ring
    @at-root {
        :focus {
            @include lib.no-js {
                @if $optional {
                    @extend %focus-ring !optional;
                } @else {
                    @extend %focus-ring;
                }
            }
        }

        :focus {
            @at-root #{lib.selector-feature-check( 'focusVisible', false )} {
                @if $optional {
                    @extend %focus-ring--where !optional;
                } @else {
                    @extend %focus-ring--where;
                }
            }
        }

        :focus-visible {
            @if $optional {
                @extend %focus-ring--visible !optional;
            } @else {
                @extend %focus-ring--visible;
            }
        }
    }

    @include _extend-selectors($_global_selectors, $optional: $optional);

    @if list.length($additional) {
        @include _extend-selectors($additional, $optional: $optional);
    }
}

@mixin extend-selector-utils(
    $additional: (),
    $optional: null,
    $allHeadingLevels: token-all-heading-levels()
) {
    $_utils_selectors: (
        // ( globals, pseudo? ),
        //
        /// ## Objects ==================================== ///
        screen-reader-text,
        //
        /// ## Objects ==================================== ///
        //
        /// ## Typography ==================================== ///
        (page-title, title),
        //
        /// ## Forms ==================================== ///
        //
        /// ## Tables ==================================== ///
        table-wrapper
    );

    /// Headings
    @each $headingLevel in $allHeadingLevels {
        $_utils_selectors: list.append($_utils_selectors, 'h#{$headingLevel}');
    }

    // font size utilities
    @each $slug, $_value in tokens.$font_sizes {
        $_utils_selectors: list.append($_utils_selectors, 'font-size-#{$slug}');
    }

    @include _extend-selectors(
        $_utils_selectors,
        $selector_prefix: '.',
        $optional: $optional
    );

    @include _extend-selectors(
        (
            // ( globals, pseudo? ),
            ('a.button', button),
            ('a.button-secondary', button-secondary)
        ),
        $optional: $optional
    );

    @if list.length($additional) {
        @include _extend-selectors($additional, $optional: $optional);
    }
}
