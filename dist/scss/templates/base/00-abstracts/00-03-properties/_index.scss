///
/// @package @maddimathon/utility-sass@0.1.0-alpha.draft
/// @since 0.1.0-alpha.draft
///

@use '../../config';
@use '../../tokens';

@use '../../../../modules/colour';
@use '../../../../modules/list';
@use '../../../../modules/map';
@use '../../../../modules/string';

@use '../../lib' as *;

@use '../00-01-functions' as *;
// @use '../00-02-mixins' as *;

/* # TOKENS & PROPERTIES
 * ======================================================================== */

@include tokens-all($custom: false);

$_customTokensToPrint: ();

@each $slug, $value in tokens.$customTokens {
    // these do nothing except else
    @if $slug == clr or $slug == themes {
    } @else {
        $_customTokensToPrint: map.set($_customTokensToPrint, $slug, $value);
    }
}

@include tokens-custom(map.flatten($_customTokensToPrint));

@if list.length(map.keys(tokens.$colours)) > 0 {
    /* ## TOKENS - COLOURS ==================================== */

    /* #region Tokens - Colours */
    @each $mode in tokens.$brightnessMode_all {
        @include colour-mode($mode, $includeDefault: true) {
            @each $slug, $map in tokens.$colours {
                @each $level, $clr in $map {
                    --clr-#{$slug}-#{$level}: #{if(
                            $mode== dark,
                            map.get(
                                $map,
                                colour.shade-map-reverse-key(
                                    $level,
                                    $map,
                                    $sort: if(
                                            config.$tokens_expandClrMaps,
                                            false,
                                            true
                                        )
                                )
                            ),
                            $clr
                        )};
                }
            }
        }
    }
    /* #endregion Tokens - Colours */
}

@if config.$include_clr {
    /* ## TOKENS - THEMES ==================================== */

    @include token-mode-each using ($brightness, $contrast) {
        @if $contrast != forced-colors {
            @if map.has-key(tokens.$themes, $brightness) {
                @if map.has-key(map.get(tokens.$themes, $brightness), $contrast)
                {
                    $flattened: map.flatten(
                        map.get(tokens.$themes, $brightness, $contrast)
                    );

                    @each $prop, $value in $flattened {
                        --theme-#{$prop}: #{var-clr(
                                string.slice($value, 1, -5),
                                string.slice($value, -3, -1),
                                $brightness
                            )};
                    }
                }
            }
        }
    }

    /*#region contrast forced-colors */
    @include forced-colors {
        @each $prop,
            $value in map.flatten(map.get(tokens.$themes, forced-colors))
        {
            --theme-#{$prop}: #{$value} !important;
        }
    }
    /*#endregion contrast forced-colors */
}
