///
/// @package @maddimathon/utility-sass@___CURRENT_VERSION___
/// @since ___PKG_VERSION___
///

@use '../../../config';
@use '../../../tokens';

@use '../../../modules/list';
@use '../../../modules/map';
@use '../../../modules/math';
@use '../../../modules/string';

// @use '../01-02-accessibility' as *;
@use '../01-03-typography' as *;

// @use '01-04-01-spacing' as *;
// @use '01-11-02-theming' as *;
// @use '01-11-03-colours' as *;

/// # TYPOGRAPHY TOKEN FUNCTIONS
/// ======================================================================== ///

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {number}
///
/// @since ___PKG_VERSION___
///
@function fs-value($slug, $fontScale: 1, $clampFontSize: null) {
    // returns
    @if not map.has-key(tokens.$font_sizes, $slug) {
        @warn "$slug '#{$slug}' did not match any of the font size tokens";
        @return ();
    }

    $size: map.get(tokens.$font_sizes, $slug);

    @if $clampFontSize == null {
        $clampFontSize: false;

        // returns - clamped value
        @if $slug == 'title' {
            $clampFontSize: true;
        }
        @if string.index($slug, 'heading-') == 1 {
            $clampFontSize: true;
        }
        @if string.index($slug, 'bigger-') == 1 {
            $clampFontSize: true;
        }
    }

    @if $clampFontSize {
        @return (
            #{math.round-to-pixel(
                    $size * $fontScale,
                    $factor: config.$fn_fontRoundToPixelFactor
                )}rem,
            clamp-font-size($size * $fontScale, $unit: 'rem')
        );
    }

    @return (#{math.round-to-pixel($size * $fontScale)}rem);
}

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {number}
///
/// @since ___PKG_VERSION___
///
@function line-height-value($level) {
    $value: map.get(tokens.$line_heights, '400');

    @if not map.has-key(tokens.$line_heights, '#{$level}') {
        @warn "$level was not a key in tokens.$line_heights";
    } @else {
        $value: map.get(tokens.$line_heights, '#{$level}');
    }

    @return $value;
}

///
/// Uses the line height config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-line-height($slug) {
    @return var(--line-height-#{$slug}, #{line-height-value($slug)});
}

/// ## VARIABLES ==================================== ///

///
/// Uses the font size config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-fs($slug, $fallback: null) {
    //
    // if theres's no fallback set, then we use the fs-value function to find one
    // returns if no fallback
    @if $fallback == null {
        $fallback: fs-value($slug);

        // returns
        @if list.length($fallback) < 1 {
            @return var(--fs-#{$slug});
        }

        $fallback: list.nth($fallback, 1);
    }

    @return var(--fs-#{$slug}, #{$fallback});
}
