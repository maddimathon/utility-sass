///
/// @package @maddimathon/utility-sass@___CURRENT_VERSION___
/// @since ___PKG_VERSION___
///

@use '../../../config';
@use '../../../tokens';

@use '../../../modules/list';
@use '../../../modules/map';
@use '../../../modules/math';
@use '../../../modules/meta';

// @use '../01-02-accessibility' as *;
// @use '../01-03-typography' as *;

/// # SPACING TOKEN FUNCTIONS
/// ======================================================================== ///

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since ___PKG_VERSION___
///
@function mrg-value-firm($level) {
    $value: map.get(tokens.$margins, '400');

    @if not map.has-key(tokens.$margins, '#{$level}') {
        @warn "$level '#{$level}' was not a key in tokens.$margins";
    } @else {
        $value: map.get(tokens.$margins, '#{$level}');
    }

    @return $value;
}

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since ___PKG_VERSION___
///
@function mrg-value-half($level) {
    @return calc(mrg-value-firm($level) - mrg-value-soft($level));
}

$_mrgValFirm_400: mrg-value-firm('400');
$_mrgValFirm_400_softened: mrg-value-firm('400');

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since ___PKG_VERSION___
///
@function mrg-value-soft($level) {
    $value: mrg-value-firm($level);

    // returns
    @if math.num-val($level) <= 400 {
        @return math.round-to-pixel($value * tokens.$margin_softener);
    }

    $percentToSoftenFully: calc($_mrgValFirm_400 / $value);
    $percentToSoftenPartially: calc(1 - $percentToSoftenFully);

    @return math.round-to-pixel(
        (($value * $percentToSoftenFully) * tokens.$margin_softener) +
            (
                ($value * $percentToSoftenPartially) *
                    (
                        tokens.$margin_softener +
                            calc(
                                (1 - tokens.$margin_softener) *
                                    tokens.$margin_softener
                            )
                    )
            )
    );
}

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {list}
///
/// @since ___PKG_VERSION___
///
@function width-value($slug, $returnAsNumber: false) {
    // returns
    @if not map.has-key(config.$widths, '#{$slug}') {
        @warn "$slug was not a key in config.$widths";
        @return ();
    }

    $num: map.get(config.$widths, '#{$slug}');

    @if meta.type-of($num) == 'number' {
        $num: $num * 1rem;
    } @else {
        $num: #{$num}rem;
    }

    @return if($returnAsNumber, $num, ($num));
}

/// ## VARIABLES ==================================== ///

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-mrg-firm($level) {
    @return var(--mrg-firm-#{$level}, #{mrg-value-firm($level)}rem);
}

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-mrg-half($level) {
    @return var(--mrg-half-#{$level}, #{mrg-value-half($level)}rem);
}

///
/// Uses the margin config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-mrg-soft($level) {
    @return var(--mrg-soft-#{$level}, #{mrg-value-soft($level)}rem);
}

///
/// Uses the width config to print the appropriate var(...) with a
/// fallback.
///
/// @since ___PKG_VERSION___
///
@function var-width($slug) {
    $fallback: width-value($slug);

    @if list.length($fallback) < 1 {
        @return var(--width-#{$slug});
    }

    @return var(--width-#{$slug}, #{list.nth($fallback, 1)});
}
