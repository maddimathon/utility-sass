///
/// @package @maddimathon/utility-sass@___CURRENT_VERSION___
/// @since 0.1.0-pre.0
///

@use '../../../modules/list';
@use '../../../modules/map';
@use '../../../modules/math';
@use '../../../modules/meta';

@use '../../../config';
@use '../../../tokens';

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha.15 — Added $unit param.
///
@function mrg-value-firm($level, $unit: 1) {
    $value: map.get(tokens.$margins, '400');

    @if not map.has-key(tokens.$margins, '#{$level}') {
        @warn "$level '#{$level}' was not a key in tokens.$margins";
    } @else {
        $value: map.get(tokens.$margins, '#{$level}');
    }

    @return if(
        meta.type-of($value) == number,
        math.add-unit($value, $unit),
        $value
    );
}

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha.15 — Added $unit param.
///
@function mrg-value-half($level, $unit: 1) {
    $value: calc(mrg-value-firm($level) - mrg-value-soft($level));

    @return if(
        meta.type-of($value) == number,
        math.add-unit($value, $unit),
        $value
    );
}

$_mrgValFirm_400: mrg-value-firm('400');
$_mrgValFirm_400_softened: mrg-value-firm('400');

///
/// Uses the margin config to prepare the appropriate numerical value (rem).
///
/// @since 0.1.0-pre.0
/// @since 0.1.0-alpha.15 — Added $unit param.
///
@function mrg-value-soft($level, $unit: 1) {
    $value: mrg-value-firm($level);

    // returns
    @if math.num-val($level) <= 400 {
        $value: math.round-to-pixel($value * tokens.$margin_softener);

        @return if(
            meta.type-of($value) == number,
            math.add-unit($value, $unit),
            $value
        );
    }

    $prct_soften_full: calc($_mrgValFirm_400 / $value);
    $prct_soften_partial: calc(1 - $prct_soften_full);

    $_full_softener: tokens.$margin_softener;

    $_partial_softener: (
        tokens.$margin_softener +
            calc((1 - tokens.$margin_softener) * tokens.$margin_softener)
    );

    $value_half_full_soft: $value * $prct_soften_full * $_full_softener;

    $value_half_partial_soft: $value * $prct_soften_partial * $_partial_softener;

    $value: math.round-to-pixel(
        $value_half_full_soft + $value_half_partial_soft
    );

    @return if(
        meta.type-of($value) == number,
        math.add-unit($value, $unit),
        $value
    );
}

///
/// Uses the widths config to prepare the appropriate numerical value (rem).
/// Returns a list of values since some are calculations that may require
/// fallbacks.
///
/// @return {list}
///
/// @since 0.1.0-pre.0
///
@function width-value($slug, $returnAsNumber: true) {
    // returns
    @if not map.has-key(config.$widths, '#{$slug}') {
        @warn "$slug was not a key in config.$widths";
        @return ();
    }

    $num: map.get(config.$widths, '#{$slug}');

    @if meta.type-of($num) == 'number' {
        $num: $num * 1rem;
    } @else {
        $num: #{$num}rem;
    }

    @return if($returnAsNumber, $num, ($num));
}

/// ## VARIABLES ==================================== ///

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-alpha.15
///
@function var-pad-firm($level) {
    $fallback: calc(1em * mrg-value-firm($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}pad-firm-#{$level}, $fallback)
    );
}

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-alpha.15
///
@function var-pad-half($level) {
    $fallback: calc(1em * mrg-value-half($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}pad-half-#{$level}, $fallback)
    );
}

///
/// Uses the margin config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-alpha.15
///
@function var-pad-soft($level) {
    $fallback: calc(1em * mrg-value-soft($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}pad-soft-#{$level}, $fallback)
    );
}

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-mrg-firm($level) {
    $fallback: calc(1rem * mrg-value-firm($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}mrg-firm-#{$level}, $fallback)
    );
}

///
/// Uses the margin config to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-mrg-half($level) {
    $fallback: calc(1rem * mrg-value-half($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}mrg-half-#{$level}, $fallback)
    );
}

///
/// Uses the margin config tokens to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-mrg-soft($level) {
    $fallback: calc(1rem * mrg-value-soft($level));

    @return if(
        config.$fn_var_replaceWithValue_margin,
        $fallback,
        var(--#{config.$cxPropPre}mrg-soft-#{$level}, $fallback)
    );
}

///
/// Uses the width config to print the appropriate var(...) with a
/// fallback.
///
/// @since 0.1.0-pre.0
///
@function var-width($slug) {
    $fallback: width-value($slug, $returnAsNumber: true);

    @if meta.type-of($fallback) == list and list.length($fallback) < 1 {
        @return var(--#{config.$cxPropPre}width-#{$slug});
    }

    @return if(
        config.$fn_var_replaceWithValue_width,
        $fallback,
        var(--#{config.$cxPropPre}width-#{$slug}, $fallback)
    );
}

/// ## GAPS ==================================== ///

$_gaps_block: map.get(tokens.$gaps, block);
$_gaps_inline: map.get(tokens.$gaps, inline);

///
/// @since 0.1.0-pre.0
///
@function gap-value($dir, $slug) {
    $dir: #{$dir};

    @if $dir != block and $dir != inline {
        @warn "$dir must be either 'block' or 'inline' (was #{$dir})";
    }

    $map: if($dir == block, $_gaps_block, $_gaps_inline);

    // returns
    @if not map.has-key($map, $slug) {
        @warn "$slug '#{$slug}' was not a key in the gaps map";
        @return ('gap-value(#{$dir}, #{$slug})');
    }

    $num: map.get($map, $slug);

    // returns
    @if $dir == block {
        //
        @if $slug == layout or $slug == layout-half {
            @return (
                calc(1vw * $num),
                clamp(
                    calc(
                        1rem * mrg-value-soft('600') / if($slug == layout, 1, 2)
                    ),
                    calc(1svw * $num),
                    calc(
                        1rem * mrg-value-soft('900') / if($slug == layout, 1, 2)
                    )
                )
            );
        }
    } @else if $dir == inline {
        //
        @if $slug == indent {
            //
            @return (
                calc(1% * $num),
                clamp(var-mrg-firm('200'), calc(1% * $num), var-mrg-firm('800'))
            );
        } @else if $slug == layout or $slug == layout-half {
            //

            @return (
                calc(1vw * $num),
                clamp(
                    calc(
                        1rem * mrg-value-firm('400') / if($slug == layout, 1, 2)
                    ),
                    calc(1svw * $num),
                    calc(
                        1rem * mrg-value-firm('900') / if($slug == layout, 1, 2)
                    )
                )
            );
        } @else if $slug == tab {
            //
            @return (
                calc(1% * $num),
                clamp(var-mrg-firm('100'), calc(1% * $num), var-mrg-firm('600'))
            );
        }
    }

    @return ($num);
}

///
/// @since 0.1.0-pre.0
///
@function gap-block-value($slug) {
    @return gap-value(block, $slug);
}

///
/// @since 0.1.0-pre.0
///
@function gap-inline-value($slug) {
    @return gap-value(inline, $slug);
}

///
/// @since 0.1.0-pre.0
///
@function var-gap($dir, $slug) {
    $fallback: list.nth(gap-value($dir, $slug), 1);

    @return if(
        config.$fn_var_replaceWithValue_gap,
        $fallback,
        var(--#{config.$cxPropPre}gap-#{$dir}-#{$slug}, $fallback)
    );
}

///
/// @since 0.1.0-pre.0
///
@function var-gap-block($slug) {
    @return var-gap(block, $slug);
}

///
/// @since 0.1.0-pre.0
///
@function var-gap-inline($slug) {
    @return var-gap(inline, $slug);
}
