///
/// @package @maddimathon/utility-sass@___CURRENT_VERSION___
/// @since 0.1.0-pre.0
///

@use '../../modules/feature-check';
@use '../../modules/list';
@use '../../modules/meta';
@use '../../modules/selector';
@use '../../modules/string';

@use '../../lib/02-mixins' as lib;

@use '../../config';
@use '../../tokens';

@use '../01-functions' as *;

$_optionalDefault: if(config.$internal_isTemplate, false, true);

///
/// @since 0.1.0-alpha.38 — Made public.
///
@mixin extend-selectors-generic($selectors, $selector_prefix: '', $optional: $_optionalDefault) {
    @each $pair in $selectors {
        $pairType: meta.type-of($pair);

        @if $pairType == string {
            #{$selector_prefix}#{$pair} {
                //
                @if $optional {
                    @extend %#{$pair} !optional;
                } @else {
                    @extend %#{$pair};
                }
            }
        } @else if $pairType == list and list.length($pair) >= 2 {
            #{$selector_prefix}#{list.nth($pair, 1)} {
                //
                @if $optional {
                    @extend %#{list.nth($pair, 2)} !optional;
                } @else {
                    @extend %#{list.nth($pair, 2)};
                }
            }
        }
    }
}

///
/// @since 0.1.0-alpha.38 — Added $additional_optional param for additional selectors that are always optional.
///
@mixin extend-selectors-globals(
    $additional: (),
    $additional_optional: (),
    $optional: $_optionalDefault,
    $allHeadingLevels: token-all-heading-levels()
) {
    $_global_selectors: (
        // ( globals, pseudo? ),
        //
        /// ## Objects ==================================== ///
        (config.$selector_root, root),
        (config.$selector_body, body),
        hr,
        //
        /// ## Typography ==================================== ///
        ('.screen-reader-text', screen-reader-text),
        ((strong, b), strong),
        ((em, i), em),
        ('a[href]', a),
        abbr,
        blockquote,
        code,
        kbd,
        p,
        pre,
        samp,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        //
        /// ## Lists ==================================== ///
        ol,
        ul,
        li,
        //
        /// ## Forms ==================================== ///
        label,
        fieldset,
        legend,
        input,
        select,
        textarea,
        ('::selection', selection),
        //
        /// ## Tables ==================================== ///
        table,
        tr,
        th,
        td
    );

    $additional_optional: list.join(
        $additional_optional,
        (
            (string.unquote('::file-selector-button'), file-selector-button),
            (
                (
                    button,
                    "[role='button']",
                    "input[type='button']",
                    "input[type='reset']",
                    "input[type='submit']"
                ),
                button
            )
        )
    );

    /// Headings - where
    @if config.$mx_extendHeadingsByRole {
        // for all levels
        @each $headingLevel in $allHeadingLevels {
            //
            @at-root :where([role='heading'][aria-level='#{$headingLevel}']) {
                @if $optional {
                    @extend %h#{$headingLevel}--where !optional;
                } @else {
                    @extend %h#{$headingLevel}--where;
                }
            }
        }
    }

    // universal focus ring
    @at-root {
        :focus {
            @include feature-check.no-js {
                @if $optional {
                    @extend %focus-ring !optional;
                } @else {
                    @extend %focus-ring;
                }
            }
        }

        :focus {
            @at-root #{feature-check.get-selector( 'focusVisible', false )} {
                @if $optional {
                    @extend %focus-ring--where !optional;
                } @else {
                    @extend %focus-ring--where;
                }
            }
        }

        :focus-visible {
            @if $optional {
                @extend %focus-ring--visible !optional;
            } @else {
                @extend %focus-ring--visible;
            }
        }
    }

    @include extend-selectors-generic($_global_selectors, $optional: $optional);

    @if list.length($additional) {
        @include extend-selectors-generic($additional, $optional: $optional);
    }

    @include extend-selectors-generic($additional_optional, $optional: true);
}

///
/// @since 0.1.0-alpha.38 — Added $additional_optional param for additional selectors that are always optional.
///
@mixin extend-selectors-utils(
    $additional: (),
    $additional_optional: (),
    $optional: $_optionalDefault,
    $allHeadingLevels: token-all-heading-levels()
) {
    $_utils_selectors: (
        // ( globals, pseudo? ),
        //
        /// ## Objects ==================================== ///
        //
        /// ## Objects ==================================== ///
        //
        /// ## Typography ==================================== ///
        unstyled-heading,
        (page-title, title),
        //
        /// ## Forms ==================================== ///
        //
        /// ## Tables ==================================== ///
        table-wrapper
    );

    /// Headings
    @each $headingLevel in $allHeadingLevels {
        $_utils_selectors: list.append($_utils_selectors, 'h#{$headingLevel}');

        @if $headingLevel < 7 {
            $additional: list.append(
                $additional,
                ('h#{$headingLevel}:where(.unstyled-heading)', 'unstyled-heading--where')
            );
        }

        $_utils_selectors: list.append(
            $_utils_selectors,
            ('h#{$headingLevel}:where(.unstyled-heading)', 'unstyled-heading--where')
        );
    }

    // font size utilities
    @each $slug, $_value in tokens.$font_sizes {
        $_utils_selectors: list.append($_utils_selectors, 'font-size-#{$slug}');
    }

    @include extend-selectors-generic(
        $_utils_selectors,
        $selector_prefix: '.',
        $optional: $optional
    );

    @include extend-selectors-generic(
        (
            // ( globals, pseudo? ),
            (('a.button[href]'), button),
            ()
        ),
        $optional: $optional
    );

    @if list.length($additional) {
        @include extend-selectors-generic($additional, $optional: $optional);
    }

    @include extend-selectors-generic($additional_optional, $optional: true);
}

///
/// @since 0.1.0-alpha.38 — Added $additional_globals_optional and $additional_utils_optional params for additional selectors that are always optional.
///
@mixin extend-selectors(
    $optional: $_optionalDefault,
    $additional_globals: (),
    $additional_globals_optional: (),
    $additional_utils: (),
    $additional_utils_optional: (),
    $allHeadingLevels: token-all-heading-levels()
) {
    @if config.$print_globals {
        @include extend-selectors-globals(
            $additional: $additional_globals,
            $additional_optional: $additional_globals_optional,
            $optional: $optional,
            $allHeadingLevels: $allHeadingLevels
        );
    }

    @if config.$print_utils {
        @include extend-selectors-utils(
            $additional: $additional_utils,
            $additional_optional: $additional_utils_optional,
            $optional: $optional,
            $allHeadingLevels: $allHeadingLevels
        );
    }
}
